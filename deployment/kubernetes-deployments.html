<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes deployments | CroudTech Development</title>
    <meta name="description" content="Croud developer standards documentation">
    
    
    <link rel="preload" href="/Croud-Standards/assets/css/0.styles.1e2ca596.css" as="style"><link rel="preload" href="/Croud-Standards/assets/js/app.1f93e9c4.js" as="script"><link rel="preload" href="/Croud-Standards/assets/js/2.d995c03c.js" as="script"><link rel="preload" href="/Croud-Standards/assets/js/9.5b5c6d27.js" as="script"><link rel="prefetch" href="/Croud-Standards/assets/js/10.e3cc811a.js"><link rel="prefetch" href="/Croud-Standards/assets/js/11.54c3f5e9.js"><link rel="prefetch" href="/Croud-Standards/assets/js/12.c0a76ea9.js"><link rel="prefetch" href="/Croud-Standards/assets/js/13.d2f0c10e.js"><link rel="prefetch" href="/Croud-Standards/assets/js/14.9e339ad8.js"><link rel="prefetch" href="/Croud-Standards/assets/js/15.2389453f.js"><link rel="prefetch" href="/Croud-Standards/assets/js/16.39994558.js"><link rel="prefetch" href="/Croud-Standards/assets/js/3.c4c78cfb.js"><link rel="prefetch" href="/Croud-Standards/assets/js/4.b72503fc.js"><link rel="prefetch" href="/Croud-Standards/assets/js/5.aa527b7f.js"><link rel="prefetch" href="/Croud-Standards/assets/js/6.3490551e.js"><link rel="prefetch" href="/Croud-Standards/assets/js/7.7c1e7ee8.js"><link rel="prefetch" href="/Croud-Standards/assets/js/8.f351c9e8.js">
    <link rel="stylesheet" href="/Croud-Standards/assets/css/0.styles.1e2ca596.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Croud-Standards/" class="home-link router-link-active"><!----> <span class="site-name">CroudTech Development</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Quality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Croud-Standards/deployment/kubernetes-deployments.html" class="active sidebar-link">Kubernetes deployments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#kubectl" class="sidebar-link">Kubectl</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#helm" class="sidebar-link">Helm</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#autohelm" class="sidebar-link">Autohelm</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#autohelm-workflow" class="sidebar-link">Autohelm Workflow</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#telepresence" class="sidebar-link">Telepresence</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#supported-platforms" class="sidebar-link">Supported Platforms</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#prequisites" class="sidebar-link">Prequisites</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/Croud-Standards/deployment/kubernetes-deployments.html#usage" class="sidebar-link">Usage</a></li></ul></li><li><a href="/Croud-Standards/deployment/helm-charts.html" class="sidebar-link">Helm Charts</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubernetes-deployments"><a href="#kubernetes-deployments" aria-hidden="true" class="header-anchor">#</a> Kubernetes deployments</h1> <h2 id="kubectl"><a href="#kubectl" aria-hidden="true" class="header-anchor">#</a> Kubectl</h2> <p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">Install and Set Up kubectl - Kubernetes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Kubectl connects to the cluster using the token or certificate stored in the kubectl config file. By default this is found at ~/.kube/config</p> <p>When dealing with multiple clusters it’s possible to have multiple kubeconfig files defined in an environment variable KUBECONFIG. Files can be separated by a colon. Make sure you include the default kubeconfig file.</p> <div class="language- extra-class"><pre class="language-text"><code>KUBECONFIG=~/.kube/config:~/my-k8s-cluster/kubeconfig.yaml:~/my-other-k8s-cluster/kubeconfig.yaml
</code></pre></div><p>To get the contents of the kubeconfig file Browse to the Rancher cluster menu for your chosen cluster. Select “Cluster” from the horizontal menu and then click the “Kubeconfig file” button. Copy the contents into your local kubeconfig file and add to the KUBECONFIG env var.</p> <h3 id="switching-between-clusters"><a href="#switching-between-clusters" aria-hidden="true" class="header-anchor">#</a> Switching between clusters</h3> <p>Each config file will have one or more named contexts defined. You can switch between clusters by using:</p> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; kubectl config use-context my-k8s-cluster
Switched to context &quot;my-k8s-cluster&quot;.
</code></pre></div><p>Find the current cluster context with</p> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; kubectl config current-context
my-k8s-cluster
</code></pre></div><p>and cluster info with:</p> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; kubectl cluster-info
Kubernetes master is running at https://rancher2-staging.croud.tech/k8s/clusters/c-jmfl8
KubeDNS is running at https://rancher2-staging.croud.tech/k8s/clusters/c-jmfl8/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</code></pre></div><h3 id="visual-studio-code-plugin"><a href="#visual-studio-code-plugin" aria-hidden="true" class="header-anchor">#</a> Visual Studio Code plugin</h3> <p>Cluster management is a little easier if you use the Kubernetes Visual Studio Code plugin. (ms-kubernetes-tools.vscode-kubernetes-tools).</p> <p>This will create an icon in the VS Code Toolbar that allows you to easily switch between namespaces and view kubernetes resources and config.</p> <h2 id="helm"><a href="#helm" aria-hidden="true" class="header-anchor">#</a> Helm</h2> <p><a href="https://github.com/helm/helm#install" target="_blank" rel="noopener noreferrer">Installing Helm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Helm allows you to manage kunernetes api resources using “Helm Charts”.</p> <h3 id="helm-chart"><a href="#helm-chart" aria-hidden="true" class="header-anchor">#</a> Helm Chart</h3> <p>A Helm Chart is a collection of api resource definition templates (using the GoLang templating syntax) with a set of default values for creating a release.</p> <h3 id="helm-release"><a href="#helm-release" aria-hidden="true" class="header-anchor">#</a> Helm release</h3> <p>Releases are created when installing a helm chart to a cluster. Helm chart releases on a cluster can be listed with <code>helm ls</code>.</p> <p>Create a release with:</p> <div class="language- extra-class"><pre class="language-text"><code>helm upgrade --install my-unique-release-name stable/my-chart --namespace my-namespace --values=./some-common-values.yaml --values=./some-more-specific-values.yaml
</code></pre></div><h3 id="helm-values"><a href="#helm-values" aria-hidden="true" class="header-anchor">#</a> Helm values</h3> <p>Helm values tend to follow a specific pattern. Viewing the chart default values should give you enough information to create a custom values file for your release. Values are inherited so you only need to include the values in your release file that you want to change. It’s also possible to add multiple values files which can help prevent repetition by having values files that might be common to all releases (DB Hosts, SMTP creds for example).</p> <h3 id="creating-helm-charts"><a href="#creating-helm-charts" aria-hidden="true" class="header-anchor">#</a> Creating helm charts</h3> <p>To create a helm chart use the <code>helm create my-chart</code> command. This will create a chart using the boilerplate helm chart files so all you need to do is modify it. It’s important to follow the conventions used in the boilerplate files (pod naming etc).</p> <h3 id="publishing-helm-charts"><a href="#publishing-helm-charts" aria-hidden="true" class="header-anchor">#</a> Publishing helm charts</h3> <p>In addition to the official stable and incubator chart repositories it’s possible to publish our own charts to a repository we host in AWS S3. We have two S3 hosted repositories, <em>croudtech-stable</em> and <em>croudtech-incubator</em>. Charts in ‘stable’ are considered production ready. Chart’s in incubator are considered bleeding edge and may not work.</p> <p>To publish a chart to our repo simply create the chart in the ‘stable’ directory of https://github.com/CroudTech/devops-helm-charts and push to GitHub. Pushes to the master branch will publish to the ‘stable’ repository and pushes to the ‘incubator’ branch will publish to the incubator repository. Incubator charts will publish on every push. Stable charts need the version number bumping in the charts Chart.yaml file.</p> <h3 id="using-the-custom-helm-repositories"><a href="#using-the-custom-helm-repositories" aria-hidden="true" class="header-anchor">#</a> Using the custom helm repositories</h3> <p>To use a custom repository you must add it to your local helm installation.</p> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; helm repo add croudtech-incubator s3://croudtech-helm-charts/croudtech-incubator
&quot;croudtech-incubator&quot; has been added to your repositories
shell&gt; helm repo add croudtech-stable s3://croudtech-helm-charts/croudtech-stable
&quot;croudtech-stable&quot; has been added to your repositories
</code></pre></div><p>To update a chart (when new charts or chart versions have been published)</p> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; helm repo update
Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the &quot;incubator&quot; chart repository
...Successfully got an update from the &quot;croudtech-incubator&quot; chart repository
...Successfully got an update from the &quot;croudtech-stable&quot; chart repository
...Successfully got an update from the &quot;stable&quot; chart repository
Update Complete. ⎈ Happy Helming!⎈
</code></pre></div><h2 id="autohelm"><a href="#autohelm" aria-hidden="true" class="header-anchor">#</a> Autohelm</h2> <p>Autohelm is a wrapper for Helm. It allows multiple chart releases to be specified in a single file.</p> <h3 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h3> <ul><li><p>Python2 Runtime</p> <p><em>Autohelm iself is built on Python2 and as such will require the Python2 runtime present</em></p></li> <li><p>Helm</p></li> <li><p>Autohelm</p></li> <li><p>Autohelm S3 Plugin</p> <p><em>The Croud Helm Chart repository is stored in S3</em></p></li></ul> <h3 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h3> <p>An auto helm file represents a single namespace.  And values can be added in-line or by referencing values files.</p> <p>For example:</p> <div class="language- extra-class"><pre class="language-text"><code>namespace: kong
repositories:
  croudtech-incubator:
    url: s3://croudtech-helm-charts/croudtech-incubator
  croudtech-stable:
    url: s3://croudtech-helm-charts/croudtech-stable
minimum_versions: #set minimum version requirements here
  helm: 2.10.0
  autohelm: 0.6.5
charts:
  ingress-kong:
    chart: kong-ingress
    repository: croudtech-stable
    version: 0.1.3
    files:
      - ../values/kong-ingress/kong-ingress.yaml
  kong-dashboard:
    chart: konga
    repository: croudtech-stable
    version: 0.1.3
    files:
      - ../values/konga/konga.yaml
</code></pre></div><p>To deploy the charts in this auto helm file run:</p> <div class="language- extra-class"><pre class="language-text"><code>autohelm plot ./my-autohelm-file.yaml
</code></pre></div><p>To deploy only a specific chart defined in the file run:</p> <div class="language- extra-class"><pre class="language-text"><code>autohelm plot ./my-autohelm-file.yaml --only kong-dashboard
</code></pre></div><p>Any chart repositories defined in the auto helm file will be automatically added or updated so you won’t need to use the <code>helm repo *</code> commands mentioned in the helm section fo this document.</p> <h2 id="autohelm-workflow"><a href="#autohelm-workflow" aria-hidden="true" class="header-anchor">#</a> Autohelm Workflow</h2> <p>In order to assist the actual deployment of autohelm files, a docker image has been created with all the neccessary libraries installed, for details how to use this Docker image to aid deployment see this <a href="/Croud-Standards/autohelm-workflow.html">Autohelm Workflow</a></p> <h2 id="telepresence"><a href="#telepresence" aria-hidden="true" class="header-anchor">#</a> Telepresence</h2> <p><a href="https://www.telepresence.io/reference/install" target="_blank" rel="noopener noreferrer">Installing Telepresence<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Telepresence is a powerful tool that allows us to create a VPN connection to the cluster Kubectl is connected to. It also allows us to replace running containers in the cluster with docker images running on our local machines.</p> <h2 id="supported-platforms"><a href="#supported-platforms" aria-hidden="true" class="header-anchor">#</a> Supported Platforms</h2> <p>The following guide apllies to Mac and Linux (Ubuntu), when running in <code>vpn-tcp</code> mode (the default), Telepresence will allow all processes running on the machine running Telepresence to access any workloads on the target cluster directly. Running a Telepresence VPN allows local development of components requiring connectivity to one or more other services without needing those service running on the local workstation.</p> <p>On Windows currently only one telepresence connection method is supported (<code>inject-tcp</code>), this allows cluster connectivity from a single process running on the machine running Telepresence.
Windows users needing VPN connectivity to clusters beyond a single terminal process are advised to go with VM based solution using the Ubuntu Platform.</p> <p>See this link for more information:</p> <p><a href="https://www.telepresence.io/reference/windows" target="_blank" rel="noopener noreferrer">https://www.telepresence.io/reference/windows<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="prequisites"><a href="#prequisites" aria-hidden="true" class="header-anchor">#</a> Prequisites</h2> <ul><li>Supported Platform</li> <li>kubectl</li> <li>kubeconfig configured with appropriate context</li></ul> <h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <p>Ensure you have all Prequisites installed, then run command below:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -s https://packagecloud.io/install/repositories/datawireio/telepresence/script.deb.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> --no-install-recommends telepresence
</code></pre></div><p>For detailed instructions follow installation guide here:</p> <p><a href="https://www.telepresence.io/reference/install" target="_blank" rel="noopener noreferrer">https://www.telepresence.io/reference/install<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <div class="language- extra-class"><pre class="language-text"><code>shell&gt; telepresence
T: Starting proxy with method 'vpn-tcp', which has the following limitations: All processes are affected, only one telepresence can run per machine, and you can't use other VPNs. You may need to add cloud hosts and headless services with --also-proxy. For a full list of method
T:  limitations see https://telepresence.io/reference/methods.html
T: Volumes are rooted at $TELEPRESENCE_ROOT. See https://telepresence.io/howto/volumes.html for details.

T: No traffic is being forwarded from the remote Deployment to your local machine. You can use the --expose option to specify which ports you want to forward.

T: Guessing that Services IP range is 10.43.0.0/16. Services started after this point will be inaccessible if are outside this range; restart telepresence if you can't access a new Service.
@Default|bash-3.2$
</code></pre></div><p>This has opened a VPN connection and you should be able to access kubernetes services using the kubernetes DNS endpoints.</p> <p>For example</p> <p>http://activity-log.stg-tennant.svc.cluster.local</p> <p>The hostnames always follow the pattern {SERVICE_NAME}.{NAMESPACE}.svc.cluster.local</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Croud-Standards/quality/release-process.html" class="prev">Release Process</a></span> <span class="next"><a href="/Croud-Standards/deployment/helm-charts.html">Helm Charts</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Croud-Standards/assets/js/app.1f93e9c4.js" defer></script><script src="/Croud-Standards/assets/js/2.d995c03c.js" defer></script><script src="/Croud-Standards/assets/js/9.5b5c6d27.js" defer></script>
  </body>
</html>
